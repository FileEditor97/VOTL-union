ALTER TABLE "guild" DROP "language";DROP TABLE "modAccess";CREATE TABLE "modAccess" ("roleId" TEXT NOT NULL, "guildId" TEXT NOT NULL, FOREIGN KEY("guildId") REFERENCES "guild"("guildId"))
ALTER TABLE "verify" DROP "verificationLink";ALTER TABLE "verify" DROP "instructionField";ALTER TABLE "verify" RENAME "panelText" TO "mainText"
ALTER TABLE "guild" ADD "ticketLogId" TEXT;CREATE TABLE "ticketPanel" ("guildId" TEXT NOT NULL, "panelColor" TEXT DEFAULT "0x112E51", FOREIGN KEY("guildId") REFERENCES "guild"("guildId"));CREATE TABLE "requestRole" ("guildId" TEXT NOT NULL, "roleId" TEXT NOT NULL UNIQUE, "description" TEXT, "type" INTEGER NOT NULL DEFAULT 0, FOREIGN KEY("guildId") REFERENCES "guild"("guildId"));CREATE TABLE "ticket" ("ticketId" INTEGER NOT NULL, "guildId" TEXT, "userId" TEXT NOT NULL, "modId" TEXT, "channelId" TEXT, "alias" TEXT NOT NULL, "closed" INTEGER NOT NULL DEFAULT 0, "roleIds" TEXT);CREATE TABLE "ticketType" ("guildId" TEXT NOT NULL, "alias" TEXT NOT NULL, "short" TEXT NOT NULL, "long" TEXT, FOREIGN KEY("guildId") REFERENCES "guild"("guildId"))
ALTER TABLE "ticket" ADD "timeClosed" INTEGER
ALTER TABLE "ticketPanel" DROP "panelColor";ALTER TABLE "verify" DROP "panelColor";ALTER TABLE "guild" ADD "color" TEXT DEFAULT "0x112E51";ALTER TABLE "modAccess" RENAME TO "roleAccess";ALTER TABLE "roleAccess" ADD "level" INTEGER NOT NULL;CREATE TABLE "userAccess" ("guildId" TEXT NOT NULL, "userId" TEXT NOT NULL, "level" INTEGER NOT NULL, FOREIGN KEY("guildId") REFERENCES "guild"("guildId"));DROP TABLE "groupMaster";DROP TABLE "groupSync";CREATE TABLE "groupMaster" ("groupId" INTEGER, "masterId" TEXT NOT NULL, "name" TEXT, "isShared" INTEGER NOT NULL DEFAULT 0, PRIMARY KEY("groupId" AUTOINCREMENT));CREATE TABLE "groupMembers" ("groupId" INTEGER NOT NULL, "guildId" TEXT NOT NULL, "canManage" INTEGER NOT NULL DEFAULT 0, FOREIGN KEY("groupId") REFERENCES "groupMaster"("groupId"))
ALTER TABLE "groupMembers" ADD "whitelisted" INTEGER NOT NULL DEFAULT 0
ALTER TABLE "guild" ADD "lastWebhook" TEXT;ALTER TABLE "guild" ADD "appealLink" TEXT
CREATE TABLE "requestPrepare" ("guildId" TEXT NOT NULL, "userId" TEXT NOT NULL, "expiresAt" INTEGER NOT NULL, "roleIds" TEXT, FOREIGN KEY("guildId") REFERENCES "guild"("guildId"));DELETE FROM "requestRole" WHERE "type"=0;ALTER TABLE "requestRole" ADD "row" INTEGER;ALTER TABLE "ticketPanel" ADD "rowName1" TEXT;ALTER TABLE "ticketPanel" ADD "rowName2" TEXT;ALTER TABLE "ticketPanel" ADD "rowName3" TEXT
DROP TABLE "ticketType";ALTER TABLE "ticketPanel" RENAME TO "ticketSettings";ALTER TABLE "ticket" DROP "alias";ALTER TABLE "ticket" ADD "tagId" INTEGER NOT NULL DEFAULT 0;ALTER TABLE "ticket" ADD "reasonClosed" TEXT;CREATE TABLE "ticketPanel" ("panelId" INTEGER, "guildId" TEXT NOT NULL, "title" TEXT, "description" TEXT, "image" TEXT, "footer" TEXT, FOREIGN KEY("guildId") REFERENCES "guild"("guildId"), PRIMARY KEY("panelId" AUTOINCREMENT));CREATE TABLE "ticketTag" ("tagId" INTEGER, "guildId" TEXT NOT NULL, "panelId" INTEGER NOT NULL, "tagType" INTEGER NOT NULL DEFAULT 1, "buttonText" TEXT, "emoji" TEXT, "location" TEXT, "message" TEXT, "supportRoles" TEXT, "ticketName" TEXT NOT NULL, "buttonStyle" INTEGER, FOREIGN KEY("guildId") REFERENCES "guild"("guildId"), FOREIGN KEY("panelId") REFERENCES "ticketPanel"("panelId"), PRIMARY KEY("tagId" AUTOINCREMENT));ALTER TABLE "ticket" ADD "closeRequested" INTEGER DEFAULT 0;ALTER TABLE "ticketSettings" ADD "autocloseTime" INTEGER NOT NULL DEFAULT 0;ALTER TABLE "ticketSettings" ADD "autocloseLeft" INTEGER NOT NULL DEFAULT 0
ALTER TABLE "guild" ADD "reportChannelId" TEXT;CREATE TABLE "guildVoice" ("guildId" TEXT NOT NULL UNIQUE, "categoryId" TEXT, "channelId" TEXT, "defaultName" TEXT, "defaultLimit" INTEGER DEFAULT 0, FOREIGN KEY("guildId") REFERENCES "guild"("guildId"));CREATE TABLE "user" ("userId" TEXT NOT NULL UNIQUE, "voiceName" TEXT, "voiceLimit" INTEGER);CREATE TABLE "voiceChannel" ("userId" TEXT NOT NULL, "channelId" TEXT NOT NULL UNIQUE)
DROP TABLE "requestPrepare";CREATE TABLE "tempRoles" ("guildId" TEXT NOT NULL,"roleId" TEXT NOT NULL,"userId" TEXT NOT NULL,"deleteAfter" INTEGER DEFAULT 0,"expireAfter" INTEGER,FOREIGN KEY("guildId") REFERENCES "guild"("guildId"))
ALTER TABLE "guild" ADD "serverLogId" TEXT;ALTER TABLE "guild" ADD "roleLogId" TEXT
ALTER TABLE "requestRole" ADD "discordInvite" TEXT
ALTER TABLE "verify" DROP "instructionText"
CREATE UNIQUE INDEX guildId ON verify(guildId); DROP TABLE "ban"; CREATE TABLE "cases" ("caseId" INTEGER, "type" INTEGER NOT NULL, "targetId" INTEGER NOT NULL, "targetTag" TEXT, "modId" INTEGER NOT NULL, "modTag" TEXT, "guildId" INTEGER NOT NULL, "reason" TEXT, "timeStart" INTEGER NOT NULL, "duration" INTEGER DEFAULT 0, "active" INTEGER NOT NULL DEFAULT 1, PRIMARY KEY("caseId" AUTOINCREMENT)); ALTER TABLE "groupMaster" DROP "isShared"; CREATE TABLE "blacklist" ("guildId" INTEGER NOT NULL, "groupId" INTEGER, "userId" INTEGER NOT NULL, "steam64" INTEGER, "reason" TEXT, "modId" INTEGER NOT NULL); CREATE TABLE "strikeExpire" ("guildId" INTEGER NOT NULL, "userId" INTEGER NOT NULL, "expireAfter" INTEGER NOT NULL, "count" INTEGER NOT NULL DEFAULT 0, "data" TEXT, UNIQUE("guildId","userId")); CREATE TABLE "autopunish" ("guildId" INTEGER NOT NULL, "strike" INTEGER NOT NULL, "actions" INTEGER NOT NULL, "data" TEXT NOT NULL, UNIQUE("guildId","strike")); ALTER TABLE "guild" ADD "strikeExpires"	INTEGER DEFAULT 7
DROP TABLE "verified"; CREATE TABLE "verified" ("discordId" INTEGER NOT NULL UNIQUE, "steam64" INTEGER, "forced" INTEGER DEFAULT 0)
DROP TABLE "groupMaster"; DROP TABLE "groupMembers"; CREATE TABLE "groups" ("groupId" INTEGER, "name" TEXT NOT NULL, "ownerId" INTEGER NOT NULL, "appealGuildId" INTEGER, PRIMARY KEY("groupId" AUTOINCREMENT)); CREATE TABLE "groupMembers" ("groupId" INTEGER NOT NULL, "guildId" INTEGER NOT NULL, "canManage" INTEGER DEFAULT 0, UNIQUE("groupId", "guildId"))
CREATE TABLE "alertActions" ("guildId" INTEGER NOT NULL, "userId" INTEGER NOT NULL, "points" INTEGER NOT NULL, UNIQUE("guildId","userId"))
DROP TABLE "verify"; CREATE TABLE "verifySettings" ("guildId" INTEGER NOT NULL UNIQUE, "roleId" INTEGER, "mainText" TEXT, "checkEnabled" INTEGER NOT NULL DEFAULT 0); DROP TABLE "verified"; CREATE TABLE "verified" ("discordId" INTEGER NOT NULL UNIQUE, "steam64" INTEGER DEFAULT 0); CREATE TABLE "logWebhooks" ("guildId" INTEGER NOT NULL UNIQUE, "moderation" TEXT, "groups" TEXT, "verify" TEXT, "tickets" TEXT, "roles" TEXT, "server" TEXT, "messages" TEXT, "members" TEXT, "voice" TEXT, "channels" TEXT, "other" TEXT); DROP TABLE "webhook"; CREATE TABLE "webhook" ("webhookId" INTEGER NOT NULL UNIQUE, "guildId" INTEGER NOT NULL, "token" TEXT); DROP TABLE "moduleOff"; DROP TABLE "guild"; CREATE TABLE "guild" ("guildId" INTEGER NOT NULL UNIQUE, "color" TEXT DEFAULT '0x112E51', "lastWebhookId" INTEGER, "appealLink" TEXT, "reportChannelId" INTEGER, "strikeExpires" INTEGER DEFAULT 7, "modulesOff" INTEGER DEFAULT 0)
DROP TABLE "user"; DROP TABLE "voiceChannel"; DROP TABLE "guildVoice"; CREATE TABLE "users"("userId" INTEGER NOT NULL UNIQUE, "voiceName" TEXT, "voiceLimit" INTEGER); CREATE TABLE "voiceChannels"("userId" INTEGER NOT NULL, "channelId" INTEGER NOT NULL UNIQUE); CREATE TABLE "guildVoice"("guildId" INTEGER NOT NULL UNIQUE, "categoryId" INTEGER, "channelId" INTEGER, "defaultName" TEXT, "defaultLimit" INTEGER DEFAULT 0)
DROP TABLE "ticketSettings"; CREATE TABLE "ticketSettings"("guildId" INTEGER NOT NULL UNIQUE, "autocloseTime" INTEGER NOT NULL DEFAULT 0, "autocloseLeft" INTEGER NOT NULL DEFAULT 0, "rowName1" TEXT, "rowName2" TEXT, "rowName3" TEXT, "otherRole" INTEGER NOT NULL DEFAULT 1); ALTER TABLE "guild" ADD "anticrash" INTEGER NOT NULL DEFAULT 0; ALTER TABLE "verifySettings" ADD "minimumPlaytime" INTEGER NOT NULL DEFAULT -1
CREATE TABLE "logExceptions" ("guildId" INTEGER NOT NULL, "targetId" INTEGER NOT NULL, UNIQUE("guildId", "targetId"))
ALTER TABLE "guild" ADD "informBan" INTEGER NOT NULL DEFAULT 1; ALTER TABLE "guild" ADD "informKick" INTEGER NOT NULL DEFAULT 1; ALTER TABLE "guild" ADD "informMute" INTEGER NOT NULL DEFAULT 1; ALTER TABLE "guild" ADD "informStrike" INTEGER NOT NULL DEFAULT 1; ALTER TABLE "guild" ADD "informDelstrike" INTEGER NOT NULL DEFAULT 0
CREATE TABLE "menuSelectRoles" ("guildId" INTEGER NOT NULL, "userId" INTEGER NOT NULL, "targetId" INTEGER NOT NULL, "expiresAfter" INTEGER NOT NULL, "roles" TEXT, UNIQUE("guildId", "userId", "targetId"))
UPDATE roleAccess SET level=3 WHERE (level=2); UPDATE roleAccess SET level=2 WHERE (level=1); CREATE TABLE "threadControl" ("guildId" INTEGER NOT NULL, "channelId" INTEGER NOT NULL UNIQUE)
ALTER TABLE "groups" ADD "selfInvite" TEXT; ALTER TABLE "guild" ADD "anticrashPing" TEXT; ALTER TABLE "groupMembers" ADD "requireVerify" INTEGER DEFAULT 0; CREATE TABLE "gameChannels" ("guildId" INTEGER NOT NULL, "channelId" INTEGER NOT NULL, "maxStrikes" INTEGER NOT NULL DEFAULT 3, UNIQUE("guildId","channelId")); CREATE TABLE "gameStrikes" ("guildId" INTEGER NOT NULL, "channelId" INTEGER NOT NULL, "userId" INTEGER NOT NULL, "count" INTEGER NOT NULL, "lastUpdate" INTEGER, UNIQUE("channelId", "userId"))
ALTER TABLE "strikeExpire" ADD "lastAddition" INTEGER; ALTER TABLE "guild" ADD "strikeCooldown" INTEGER DEFAULT 0; ALTER TABLE "ticketSettings" ADD "timeToReply" INTEGER NOT NULL DEFAULT 0; ALTER TABLE "ticket" ADD "replyWait" INTEGER DEFAULT 0; ALTER TABLE "groupMembers" DROP "requireVerify"; ALTER TABLE "groups" ADD "memberVerify" INTEGER NOT NULL DEFAULT 0
CREATE TABLE "tempBan" ("guildId" INTEGER NOT NULL, "userId" INTEGER NOT NULL, "until" INTEGER NOT NULL, UNIQUE("guildId","userId")); ALTER TABLE "groups" DROP "memberVerify"; ALTER TABLE "groups" ADD "memberVerify" INTEGER NOT NULL DEFAULT -1
DROP TABLE "roleAccess"; DROP TABLE "userAccess"; CREATE TABLE "accessRole" ("guildId" INTEGER NOT NULL, "roleId" INTEGER NOT NULL, "level" INTEGER NOT NULL, UNIQUE("guildId", "roleId")); CREATE TABLE "accessUser" ("guildId" INTEGER NOT NULL, "userId" INTEGER NOT NULL, "level" INTEGER NOT NULL, UNIQUE("guildId", "userId"));
CREATE TABLE "cases_new" ("rowId" INTEGER, "localId" INTEGER, "type" INTEGER NOT NULL, "targetId" INTEGER NOT NULL, "targetTag" TEXT, "modId" INTEGER NOT NULL, "modTag" TEXT, "guildId" INTEGER NOT NULL, "reason" TEXT, "timeStart" INTEGER NOT NULL, "duration" INTEGER DEFAULT 0, "active" INTEGER NOT NULL DEFAULT 1, "logUrl" TEXT, PRIMARY KEY("rowId" AUTOINCREMENT)); INSERT INTO "cases_new" ("rowId", "type", "targetId", "targetTag", "modId", "modTag", "guildId", "reason", "timeStart", "duration", "active") SELECT "caseId", "type", "targetId", "targetTag", "modId", "modTag", "guildId", "reason", "timeStart", "duration", "active" FROM "cases"; WITH CTE AS (SELECT rowId, ROW_NUMBER() OVER (PARTITION BY guildId ORDER BY timeStart) AS localId FROM "cases_new") UPDATE "cases_new" SET localId = (SELECT localId FROM CTE WHERE CTE.rowId = cases_new.rowId); DROP TABLE "cases"; ALTER TABLE "cases_new" RENAME TO "cases";
ALTER TABLE "guild" ADD "rulesLink" TEXT; CREATE TABLE "modReport" ("guildId" INTEGER NOT NULL UNIQUE, "channelId" INTEGER NOT NULL, "roleIds" TEXT NOT NULL, "nextReport" INTEGER NOT NULL, "interval" INTEGER NOT NULL DEFAULT 7);
CREATE TABLE "persistentRole" ("roleId" INTEGER NOT NULL UNIQUE, "guildId" INTEGER NOT NULL); CREATE TABLE "returnRole" ("guildId" INTEGER NOT NULL, "userId" INTEGER NOT NULL, "roleIds" TEXT NOT NULL, "expiresAfter" INTEGER, UNIQUE("guildId","userId"))
ALTER TABLE "ticketSettings" ADD "roleSupport" TEXT; UPDATE requestRole SET type=3 WHERE (type=2); UPDATE requestRole SET type=2 WHERE (type=1);
CREATE TABLE "playerComments" ("steam64" INTEGER NOT NULL, "authorId" INTEGER NOT NULL, "comment" TEXT, "timestamp" INTEGER NOT NULL, UNIQUE("steam64","authorId"));
ALTER TABLE "guild" ADD "roleWhitelist" INTEGER DEFAULT 0
ALTER TABLE "ticketSettings" ADD "deletePing" INTEGER DEFAULT 1; ALTER TABLE "ticketSettings" ADD "allowClose" INTEGER DEFAULT 0; ALTER TABLE "ticketSettings" ADD "transcripts" INTEGER DEFAULT 1; ALTER TABLE "verifySettings" ADD "additionalRoles" TEXT;
CREATE TABLE "requestRole_new" ("guildId" INTEGER NOT NULL, "roleId" INTEGER NOT NULL UNIQUE, "description" TEXT, "type" INTEGER NOT NULL DEFAULT 0, "row" INTEGER, "discordInvite" TEXT); INSERT INTO "requestRole_new"("guildId","roleId","description","type","row","discordInvite") SELECT CAST("guildId" AS INTEGER),CAST("roleId" AS INTEGER),"description","type","row","discordInvite" FROM "requestRole"; DROP TABLE "requestRole"; ALTER TABLE "requestRole_new" RENAME TO "requestRole";
CREATE TABLE "ticketTag_new" ("tagId" INTEGER, "guildId" INTEGER NOT NULL, "panelId" INTEGER NOT NULL, "tagType" INTEGER NOT NULL DEFAULT 1, "buttonText" TEXT, "emoji" TEXT, "location" INTEGER, "message" TEXT, "supportRoles" TEXT, "ticketName" TEXT NOT NULL, "buttonStyle" INTEGER, PRIMARY KEY("tagId" AUTOINCREMENT)); INSERT INTO "ticketTag_new"("tagId","guildId","panelId","tagType","buttonText","emoji","location","message","supportRoles","ticketName","buttonStyle") SELECT "tagId",CAST("guildId" AS INTEGER),"panelId","tagType","buttonText","emoji",CAST("location" AS INTEGER),"message","supportRoles","ticketName","buttonStyle" FROM "ticketTag"; DROP TABLE "ticketTag"; ALTER TABLE "ticketTag_new" RENAME TO "ticketTag";
CREATE TABLE "ticketPanel_new" ("panelId" INTEGER, "guildId" INTEGER NOT NULL, "title" TEXT, "description" TEXT, "image" TEXT, "footer" TEXT, PRIMARY KEY("panelId" AUTOINCREMENT)); INSERT INTO "ticketPanel_new"("panelId","guildId","title","description","image","footer") SELECT "panelId",CAST("guildId" AS INTEGER),"title","description","image","footer" FROM "ticketPanel"; DROP TABLE "ticketPanel"; ALTER TABLE "ticketPanel_new" RENAME TO "ticketPanel";
CREATE TABLE "ticket_new" ("ticketId" INTEGER NOT NULL, "userId" INTEGER NOT NULL, "modId" INTEGER, "guildId" INTEGER, "channelId" INTEGER, "closed" INTEGER NOT NULL DEFAULT 0, "timeClosed" INTEGER, "roleIds" TEXT, "tagId" INTEGER NOT NULL DEFAULT 0, "reasonClosed" TEXT, "closeRequested" INTEGER DEFAULT 0, "replyWait" INTEGER DEFAULT 0); INSERT INTO "ticket_new"("ticketId","userId","modId","guildId","channelId","closed","timeClosed","roleIds","tagId","reasonClosed","closeRequested","replyWait") SELECT "ticketId",CAST("userId" AS INTEGER),CAST("modId" AS INTEGER),CAST("guildId" AS INTEGER),CAST("channelId" AS INTEGER),"closed","timeClosed","roleIds","tagId","reasonClosed","closeRequested","replyWait" FROM "ticket"; DROP TABLE "ticket"; ALTER TABLE "ticket_new" RENAME TO "ticket";
CREATE TABLE "tempRoles_new" ("guildId" INTEGER NOT NULL, "roleId" INTEGER NOT NULL, "userId" INTEGER NOT NULL, "deleteAfter" INTEGER DEFAULT 0, "expireAfter" INTEGER); INSERT INTO "tempRoles_new"("guildId","roleId","userId","deleteAfter","expireAfter") SELECT CAST("guildId" AS INTEGER),CAST("roleId" AS INTEGER),CAST("userId" AS INTEGER),"deleteAfter","expireAfter" FROM "tempRoles"; DROP TABLE "tempRoles"; ALTER TABLE "tempRoles_new" RENAME TO "tempRoles";
CREATE TABLE "levelSettings" ("guildId" INTEGER NOT NULL UNIQUE, "enabled" INTEGER NOT NULL DEFAULT 0, "exemptChannels" INTEGER); CREATE TABLE "levelPlayers" ("userId" INTEGER NOT NULL, "guildId" INTEGER NOT NULL, "exp" INTEGER DEFAULT 0, "globalExp" INTEGER DEFAULT 0, "lastUpdate" INTEGER DEFAULT 0, UNIQUE("userId","guildId"));
DROP TABLE "alertActions";
ALTER TABLE "logWebhooks" ADD "levels" TEXT;
CREATE TABLE "levelRoles" ("guildId" INTEGER NOT NULL, "level" INTEGER NOT NULL, "roles" INTEGER NOT NULL, "exact" INTEGER DEFAULT 1, "type" INTEGER DEFAULT 0, UNIQUE("guildId","level")); ALTER TABLE "levelPlayers" ADD "voiceTime" INTEGER DEFAULT 0; ALTER TABLE "levelPlayers" ADD "voiceExp" INTEGER DEFAULT 0; ALTER TABLE "levelPlayers" RENAME "exp" TO "textExp"; ALTER TABLE "levelSettings" ADD "enabledVoice" INTEGER DEFAULT 1;
ALTER TABLE "levelSettings" DROP "exemptChannels"; ALTER TABLE "levelSettings" ADD "exemptChannels" TEXT; DROP TABLE "levelRoles"; CREATE TABLE "levelRoles" ("guildId" INTEGER NOT NULL, "level" INTEGER NOT NULL, "roles" TEXT NOT NULL, "exact" INTEGER DEFAULT 1, "type" INTEGER DEFAULT 0, UNIQUE("guildId","level","type"))
ALTER TABLE "logWebhooks" DROP "other"; ALTER TABLE "logWebhooks" ADD "bot" TEXT;
CREATE TABLE "autopunish_new" ("guildId" INTEGER NOT NULL, "strike" INTEGER NOT NULL, "actions" INTEGER NOT NULL, "data" TEXT, UNIQUE("guildId","strike")); INSERT INTO "autopunish_new"("guildId", "strike", "actions", "data") SELECT "guildId", "strike", "actions", "data" FROM "autopunish"; DROP TABLE "autopunish"; ALTER TABLE "autopunish_new" RENAME TO "autopunish";
